h1. API для мобильного приложения клиента

*API и мобильное приложение клиента все еще находятся в разработке. Пожалуйста, будьте готовы к небольшим изменениям.*

*Документация также претерпевает изменения. Следите за обновлениями.*

h2. Статус API

Система активно разрабатывается как и API, которые она предоставляет. Для каждого элемента API определен его статус, определяющий степень его стабильности/готовности для использования:

 * **experimental** - Экспериментальный. Еще не достаточно хорошо протестированы, велика вероятность каких-либо изменений в форматах запросов/ответов, также возможно изъятие функции из API;
 * **candidat** - API протестирован командой разработки, возможны мелкие изменения в форматах запросов (с большой вероятностью без потери обратной совместимости при переходе от experimental к unstable);
 * **stable** - API зафиксирован. Изменения могут быть внесены только при условии сохранения обратной совместимости. Если сохранение обратной совместимости невозможно, будет разработана новая версия интерфейсного вызова.

API в рамках одной major версии может быть только расширен (расширение интерфейса старых запросов, добавление новых).

h2. HTTP API v1.xx

В этой секции приведен текущий статус API версии v1.xx. 

h3. Вызовы, не требующие авторизации

|_.Method|_.URI|_.Status|_.Page Link|_.Since|
|GET|/api/client/mobile/1.1/context|**candidat**|[[link|Получение контекста API]]|1.19|
|POST|/api/client/mobile/1.0/registration/submit|**candidat**|[[link|Регистрация клиента]]|1.19|
|GET|/api/client/mobile/1.0/registration/resubmit|**candidat**|[[link|Повторная отправка кода подтверждения]]|1.19|
|GET|/api/client/mobile/1.0/registration/confirm|**candidat**|[[link|Подтверждение клиента]]|1.19|
|GET|/api/client/mobile/1.0/address/address|**candidat**|[[link|Поиск адреса]]|1.19|
|GET|/api/client/mobile/1.0/address/point|**candidat**|[[link|Поиск адресной точки]]|1.19|
|GET|/api/client/mobile/1.0/address/nearest|**candidat**|[[link|Поиск адреса по координатам]]|1.19|
|POST|/api/client/mobile/1.0/order/estimate|**candidat**|[[link|Предварительная оценка заказа]]|1.19|

h3. Требуется [[авторизация|HMAC авторизация]]

|_.Method|_.URI|_.Status|_.Page Link|_.Since|
|POST|/api/client/mobile/2.0/orders|**candidat**|[[link|Создание заказа]]|1.19|
|GET|/api/client/mobile/1.0/orders|**candidat**|[[link|Получение списка заказов]]|1.19|
|GET|/api/client/mobile/1.0/orders/{id}|**candidat**|[[link|Получение подробностей по заказу]]|1.19|
|DELETE|/api/client/mobile/1.0/orders/{id}|**candidat**|[[link|Отмена заказа]]|1.19|
|GET|/api/client/mobile/1.0/history|**candidat**|[[link|История поездок]]|1.19.3|

На страницах с детальным описанием запросов могут присутствовать дополнительные замечания по доступности функционала в зависимости от версии системы.

h3. HTTP headers

Во всех HTTP запросах к API должны быть представлены следующие заголовки:

|_.Name|_.Type|_.Description|
|Hive-Context|string|Идентификатор контекста, определяющий службу такси, набор тарифов, региональные настройки в рамках которых будут приниматься заказы. Один сервер может предоставлять несколько таких контекстов одновременно.|

Если по каким-либо причинам хотя бы один из обязательных заголовков представлен не будет, сервер вернет код ответа - 400.

Система также распознает следующие необязательные HTTP заголовки:

|_.Name|_.Type|_.Description|
|Accept-Language|string|Нужен для формирования локализованных текстов сообщений для отображения в мобильном приложении. Значение локали должно соответсвовать стандарту "RFC 2616":https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.4. Если это значение не указано - будут использоваться текущие региональные настройки сервера|

h3. Ответ от сервера

Возможные варианты ответа от сервера:

|_.HTTP-Code|_.Response Body|
|200|Тело ответа будет содержать JSON Array или JSON Object в соответствии со спецификацией запроса|
|400|Тело ответа будет содержать JSON документ типа [[ErrorObj|Home#errorobj]] содержащий код ошибки и локализованное сообщение с описанием причины|
|404|Тело ответа будет пустым|
|500|Тело ответа будет пустым|

Если запрос был успешно выполнен, ответ вернется с кодом 200.

h2. Ошибки

h3. ErrorObj

Общий формат объекта для передачи сообщений об ошибках

|_.Name|_.Type|_.Required|_.Description|
|code|number|true|Код ошибки|
|message|string|true|Локализованное описание ошибки|

Пример ответа с описанием ошибки:
<pre><code>
{
    "code": -10003,
    "message": "Missing parameter: my-very-valueable-parameter."
}
</code></pre>

h3. Коды ошибок

Общие коды ошибок

|_.Code|_.Description|
|-10001|Отсутствует обязательный заголовок|
|-10002|Неверный формат заголовка|
|-10003|Отсутствует обязательный параметр запроса|
|-10004|Неверный формат параметра запроса|
|-10005|Неверный формат JSON-документа в теле запроса|
|-10006|Переданный идентификатор контекста (заголовок Hive-Context) не существует|
